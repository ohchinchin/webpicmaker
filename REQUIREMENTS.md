# TRPG Web Application 要件定義書

## 1. 概要
- **目的**: LLM（大規模言語モデル）をゲームマスター（GM）とし、ジャズのセッションのようにユーザーと即興で対話しながら物語を紡ぐTRPGスタイルのWebアプリケーションを構築する。
- **プラットフォーム**: Webブラウザ
- **ホスティング/デプロイ**: Vercel
- **ソースコード管理**: GitHub

## 2. コア機能要件
### 2.1 LLM連携 (OpenRouter)
- **API**: OpenRouterを利用し、無料枠（Freeモデル）のLLMからテキスト生成を行う。
- **役割**: 世界観の生成、状況説明、NPCのセリフ、ユーザー行動に対する結果判定（ストーリー進行）。

### 2.2 ゲームシステム
- **世界観の自動生成**: ゲーム開始時、LLMがランダムな世界観（SF、ファンタジー、サイバーパンク、現代ホラーなど）を動的に生成し、ゲームの舞台として設定する。
- **難易度選択**: オープニング画面にて、以下の3つから難易度を選択可能とする。
  - **厳しめ**: ユーザーの行動次第で容易にキャラクターが死亡またはゲームオーバーに直結するシビアな判定基準。
  - **普通**: 標準的なTRPGの難易度。適度な緊張感を持たせる。
  - **易しめ**: 致命的な失敗を極力避け、ストーリー進行やロールプレイを重視する難易度。
- **インタラクティブなストーリー進行**: 
  - GM（LLM）から状況説明が行われ、ユーザーに「どう行動するか？」の判断を促す。
  - ユーザーはフリーテキスト（自由記述）で自身の行動を入力する。
  - LLMはユーザーの行動内容と難易度設定に基づき、結果を判定して次の展開を提示する。

### 2.3 画像生成連携 (Pollinations.ai)
- **場面ビジュアルの生成**: 現在の場面や状況に合わせた画像を Pollinations.ai を用いて自動生成し、UI上に表示して没入感を高める。

### 2.4 セキュリティ・インフラ要件
- **APIキー管理**: OpenRouterのAPIキーなどの機密情報は、ローカル環境では `.env` ファイルで管理する。
- **バージョン管理制限**: `.env` ファイルは Git (`.gitignore`) で除外され、GitHubの公開・非公開リポジトリにはコミットしない。
- **本番環境の秘匿性**: デプロイ環境(Vercel)では環境変数をVercelのプロジェクト設定画面から登録する。APIの呼び出しはブラウザ上から直接行わず、Vercelのサーバーサイド処理（API Route等）を経由して実行し、APIキー漏洩を防ぐ。
